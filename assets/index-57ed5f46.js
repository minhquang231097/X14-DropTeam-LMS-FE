import{r as o,A as Z,_ as ee,j as t,a as te,b as se,L as re,B as x}from"./index-66f4439b.js";import{a as z,c as ae}from"./customParseFormat-e572864e.js";import{A as ne,T as d}from"./index-b1d286ea.js";import{g as oe}from"./coursesList.api-aacf9e29.js";import{s as le,g as ie}from"./searchWorkplaceForAdmin-4da33f71.js";import{h as C}from"./http-c5fb7bd7.js";import{b as ce}from"./classesList.api-9ebd59f7.js";import{F as s}from"./index-d0df1089.js";import{u}from"./useQuery-ef353a59.js";import{u as de}from"./useMutation-24a2a0cd.js";import{B as ue}from"./Breadcrumb-2f9a9b09.js";import{C as me}from"./index-8ed043f7.js";import{T as pe}from"./Table-57a5b6e0.js";import{M as w}from"./index-92de84a7.js";import{R,C as l}from"./row-afd6c259.js";import{S as m}from"./index-772a2eaf.js";import{I as he}from"./index-77b0e24c.js";import{S as O}from"./index.esm-585c5a33.js";import{n as y}from"./index-b795be15.js";import"./logo-with-shadow-2b5099bc.js";import"./TextArea-61888de0.js";import"./utils-bbe17cbb.js";import"./DownOutlined-69c734f1.js";import"./index-5079de6b.js";import"./PlusOutlined-788f7a4a.js";import"./index-345bdbcd.js";import"./SearchOutlined-0de1a286.js";var xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};const ge=xe;var fe=function(p,j){return o.createElement(Z,ee({},p,{ref:j,icon:ge}))};const ye=o.forwardRef(fe),Ce=async a=>{C.post("/regist-course/admin",{...a})},je=async(a,p)=>C.get("/regist-course",{params:{page:a,limit:p}}),Se=a=>C.get("/user",{params:{course_id:a}});z.extend(ae);const be=()=>{const[a]=s.useForm(),p=te(),{confirm:j}=w,[r,M]=o.useState(void 0),[k,A]=o.useState(void 0),[v,T]=o.useState(void 0),[P,N]=o.useState(void 0),[E,B]=o.useState([]),[S]=se(),i=S.get("page")??1,h=S.get("limit")??50,q=S.get("search")??null,[K,c]=o.useState(!1),[D,I]=o.useState(!1),{data:g}=u({queryKey:["regist-course",i,h],queryFn:async()=>(await je(i,h)).data});console.log(g);const L=e=>{const{current:n,pageSize:f}=e,X=q?`&search=${q}`:"";p(`/admin/courses/register-course?page=${n}&limit=${f}${X}`)},{data:b}=u({queryKey:["courses",i,h],queryFn:async()=>(await oe(1,50)).data.data}),{data:$}=u({queryKey:["workplaces"],queryFn:async()=>(await le("ON")).data.data});console.log(r);const{data:U}=u({queryKey:["classes",r],queryFn:async()=>(await ce(r)).data.data,enabled:!!r}),{data:Y}=u({queryKey:["user",i,h],queryFn:async()=>(await ie("STUDENT",i,50)).data.data}),{data:W}=u({queryKey:["user",r],queryFn:async()=>(await Se(r)).data.data,enabled:!!r}),{mutate:Q,isLoading:_}=de(Ce,{onSuccess:()=>{y.success({message:"Update successful",description:"The student has been successfully registered"}),c(!1)},onError:e=>{y.error({message:"Update failed",description:e.message})},retry:3}),H={selectedRowKeys:E,onChange:e=>{console.log("selectedRowKeys changed: ",e),B(e)}},F=e=>{M(e)},J=async()=>{try{await C.post("/class/add-student"),y.success({message:"Add students successful",description:"The chosen students has been added successfully"})}catch(e){y.error({message:"Add students failed",description:e.message})}c(!1)},V=()=>{setTimeout(()=>{j({icon:t.jsx(ye,{}),content:"Are you sure?",onOk(){J()},onCancel(){c(!1)}})},1e3)},G=[{title:"Student Name",dataIndex:"fullname",width:"15%"},{title:"Email",dataIndex:"email",width:"20%"},{title:"Phone Number",dataIndex:"phone_number",width:"15%"},{title:"Day Of Birth",width:"15%",render:e=>{var n;return t.jsx(d.Text,{children:(n=e.student)==null?void 0:n.dob})}},{title:"Registration Course",width:"20%",render:e=>{var n;return t.jsx(d.Text,{children:(n=e.course)==null?void 0:n.title})},filterSearch:!0,filterMultiple:!0,filters:(b??[]).map(e=>({value:e.title,text:e.title})),onFilter:(e,n)=>{var f;return console.log(e),String((f=n.course)==null?void 0:f.title).indexOf(String(e))===0}},{title:"Registration Date",dataIndex:"create_at",width:"15%",render:e=>t.jsx(d.Text,{children:z(e).format("DD/MM/YYYY")})}];return t.jsxs(t.Fragment,{children:[t.jsx(ue,{items:[{title:t.jsx(re,{to:"/admin",children:"Home"})},{title:"Register Course"}],style:{padding:"4px",fontSize:"16px"}}),t.jsxs(me,{children:[t.jsx(d.Title,{level:3,className:"mt-0 mx-1",children:"Register Course"}),t.jsx("div",{className:"flex justify-between py-2",children:t.jsx(x,{type:"primary",onClick:()=>c(!0),children:"Register Course"})}),g&&t.jsx(pe,{rowKey:e=>e._id,rowSelection:H,columns:G,dataSource:g.data,pagination:{position:["bottomRight"],current:Number(i),pageSize:Number(h),defaultCurrent:1,defaultPageSize:10,pageSizeOptions:[5,10,20,50],showSizeChanger:!0,showQuickJumper:!0,total:g.total},onChange:L,style:{marginTop:16}})]}),t.jsx(w,{title:t.jsx(d.Text,{style:{fontSize:"24px"},children:"Register Course Modal"}),open:K,onCancel:()=>c(!1),footer:null,children:t.jsxs(s,{form:a,onFinish:Q,layout:"vertical",style:{paddingTop:"8px"},children:[t.jsxs(R,{gutter:16,children:[t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Course Title",name:"course_id",rules:[{required:!0,message:"Please enter the course title"}],children:t.jsx(m,{placeholder:"Select",options:(b||[]).map(e=>({value:e._id,label:e.title})),value:r,onChange:F,showSearch:!0})})}),t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Facility Name",name:"workplace_id",rules:[{required:!0,message:"Please enter the facility name"}],children:t.jsx(m,{placeholder:"Select",options:($||[]).map(e=>({value:e._id,label:e.name})),value:k,onChange:e=>A(e),showSearch:!0})})}),t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Student Name",name:"student_id",rules:[{required:!0,message:"Please enter the student name"}],children:t.jsx(m,{placeholder:"Select",options:(Y||[]).map(e=>({value:e._id,label:e.fullname})),mode:"multiple",maxTagCount:"responsive",value:v,onChange:e=>T(e),showSearch:!0})})}),t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Note",name:"note",rules:[{required:!0,message:"Please enter some notes"}],children:t.jsx(he.TextArea,{placeholder:"Type..."})})})]}),t.jsx(s.Item,{children:t.jsxs(O,{size:"middle",style:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(x,{type:"default",onClick:()=>c(!1),children:"Cancel"}),t.jsx(x,{type:"primary",htmlType:"submit",loading:_,children:"Register"})]})})]})}),t.jsx(w,{title:t.jsx(d.Text,{style:{fontSize:"24px"},children:"Add Students Modal"}),open:D,onCancel:()=>I(!1),footer:null,children:t.jsxs(s,{form:a,layout:"vertical",style:{paddingTop:"8px"},children:[t.jsxs(R,{gutter:16,children:[t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Course Title",name:"course_id",rules:[{required:!0,message:"Please enter the course title"}],children:t.jsx(m,{placeholder:"Select",options:(b||[]).map(e=>({value:e._id,label:e.title})),value:r,onChange:F,showSearch:!0})})}),t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Class Code",name:"class_id",rules:[{required:!0,message:"Please enter the class code"}],children:t.jsx(m,{placeholder:"Select",options:(U||[]).map(e=>({value:e._id,label:e.class_code})),value:P,onChange:e=>N(e),disabled:!r,showSearch:!0})})}),t.jsx(l,{span:24,children:t.jsx(s.Item,{label:"Students",name:"student_id",rules:[{required:!0,message:"Please enter the course title"}],children:t.jsx(m,{placeholder:"Select",options:(W||[]).map(e=>({value:e._id,label:e.fullname})),value:v,onChange:e=>T(e),showSearch:!0})})})]}),t.jsx(s.Item,{children:t.jsxs(O,{size:"middle",style:{display:"flex",justifyContent:"flex-end"},children:[t.jsx(x,{type:"default",onClick:()=>I(!1),children:"Cancel"}),t.jsx(x,{type:"primary",htmlType:"submit",onClick:V,loading:_,children:"Confirm"})]})})]})})]})},Ge=()=>t.jsx(ne,{content:t.jsx(be,{})});export{Ge as default};
